{% extends "layout.html" %}

{% block title %}
    {{account.user_data.data.me.displayname}}
{% endblock %}
{% block platform %}
    {% if platform != None%}
        {{platform.name}}
    {%else%}
        set platform
    {% endif %}
{% endblock %}

{% block model %}
    {% if model%}
        @{{model.username}}
    {%else%}
       set model
    {% endif %}
{% endblock %}

    {%block main%}
            <div class="main-box">
                <div class="header">
                    <h1>Account details</h1>
                    <div class="action-links scroll">
                        <a href="/accounts" class="eleveted-a">
                            accounts
                        </a>
                        <a href="" class="eleveted-a delete Do-you-want-to-delete-this-account?">
                            delete this account
                        </a>
                        <a href="" class="eleveted-a upload-image">
                            add images
                        </a>
                    </div>
                </div>

                <div class="main-container">
                    <div class="holder profile-holder scroll">
                        <div class="profile-card">
                            <div class="profile-image" class="item-header"  
                            style="background: url('{{account.user_data.data.me.primaryImage.square800}}');
                            background-repeat: no-repeat;
                            background-size: cover;
                            background-position:top">
                                <!-- <img src="../../images/1172082582405921790.jpeg" alt=""> -->
                            </div>
                            <div class="profile-card-details">
                                <h4>
                                    {{account.user_data.data.me.displayname}}
                                </h4>
                                <div class="d-status">
                                    <p class="bg-success">Active</p>
                                    {% if account.user_data.data.me.selfieVerifiedStatus == 'UNVERIFIED' %}
                                        <p class="bg-danger">Not verified</p>
                                    {%else%}
                                    <p class="bg-success">Not verified</p>
                                    {%endif%}

                                    <p class="bg-warning">
                                            {% if account.user_data.data.me.notificationCounts.likesMutual < 1%}
                                            not matched
                                            {%else%}
                                            matched
                                            {%endif%}
                                    </p>
                                </div>
                                <div class="d-items">
                                    <p>
                                        {{account.user_data.data.me.notificationCounts.likesMutual}} matches
                                    </p>
                                    <p>
                                        {{account.user_data.data.me.notificationCounts.swipes}} liked
                                    </p>
                                    <p>
                                        {{account.user_data.data.me.notificationCounts.likesIncoming}} likes
                                    </p>
                                    <p>
                                        {{account.user_data.data.me.notificationCounts.messages}} messages
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="profile-details">
                            <ul class="p-details-items">
                                <li>
                                    <i class="fa fa-envelope"></i>
                                    {{account.user_data.data.me.emailAddress}}
                                </li>
                                <li>
                                    <i class="fas fa-phone-square"></i>
                                    +1{{account.phone.number}}
                                </li>
                                <li>
                                    <i class="fa fa-venus-mars"></i>
                                    {%if account.user_data.data.me.binaryGenderLetter == 'f'%}
                                        Female
                                    {%else%}
                                        Male
                                    {%endif%}
                                </li>
                                <li style="display: none;">

                                </li>
                            </ul>
                            <div class="p-details-bio">
                                    <div class="container">
                                        <i class="fa fa-map-marker"></i>
                                        <input type="text" id="locInput" value=" {{account.user_data.data.me.userLocation.publicName[0]}}, {{account.user_data.data.me.userLocation.publicName[1]}}" class="text-style bio-input" readonly>
                                        <button class="" id="updateButtonl">Update</button>
                                    </div>
                                </div>
                                    <!-- {{account.user_data.data.me.userLocation.publicName[0]}}, {{account.user_data.data.me.userLocation.publicName[1]}} -->
                                
                            
                            <div class="p-details-bio">
                                <div class="container">
                                    <input type="text" id="bioInput" value="{{account.bio}}" class="text-style bio-input" readonly>
                                    <button class="" id="updateButton">Update</button>
                                </div>
                                <!-- <p>
                                    {{account.bio}}
                                </p> -->
                            </div>
                            <ul class="p-details-images" id="profile-images">
                                {%for image in images%}
                                <li>
                                    <img src="{{image.square800}}" class="clickable-image" accountId="{{id}}" alt="">
                                </li>
                                {%endfor%}
                                
                                <span>
                                    <a href="" class="view-all">
                                        view all
                                    </a>
                                </span>
                            </ul>
                            <div class="p-details-actions">
                                <a href="" class="delete Do-you-want-to-delete-this-account?">
                                    Delete account
                                </a>
                                <a href="" class="upload-account-image">
                                    Add images
                                </a>
                                <a href="" class="view-matches m">
                                View matches
                                </a>
                                <a href="" class="view-matches l">
                                    View likes
                                </a>
                                <a href="" class="view-matches lm">
                                    View liked me
                                </a>
                                <a href="" class="view-matches pm">
                                    View potential matches
                                </a>
                            </div>
                            <div id="map" class="map p-details-actions"></div>
                        </div>
                    </div>
                </div>
            </div>
        <style>
            .container {
            display: flex;
            align-items: center;
            }

            .bio-input {
                flex-grow: 1;
                margin-right: 10px;
            }

            .text-style {
                border: none;
                background-color: transparent;
                padding: 0;
                font-size: inherit;
                font-family: inherit;
                color: inherit;
                outline: none;
            }  
            .map{
                height: 40%;
            }
        
            
        </style>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script>
            $(document).ready(function() {
                // Function to handle the update button click event
                $('#updateButton').click(function() {
                    // Make the input field editable
                    $('#bioInput').removeClass('text-style').removeClass('border-style').prop('readonly', false);
                    // Change the button text and click event
                    $('#updateButton').val('Submit').unbind('click').click(function() {
                        // Get the updated bio from the input field
                        var updatedBio = $('#bioInput').val();
                        // Make a POST request to the update endpoint with the updated bio
                        $.ajax({
                            url: '/update/bio/{{id}}',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({data: updatedBio}),
                            success: function(response) {
                                // Handle the response
                                console.log(response);
                                // Reload the page
                                location.reload();
                            }
                        });
                    });
                });
            });
            const id ='{{id}}';
        </script>
        <!-- <script>
            $(document).ready(function() {
            // Handle click event on the clickable image
            $('.clickable-image').click(function() {
                // Get the image source and account ID
                var imageSrc = $(this).attr('src');
                var accountId = '{{id}}'; // Replace with the actual account ID
                
                // Show the confirmation window
                var confirmation = confirm('Do you want to delete the image?');
                
                if (confirmation) {
                    // Delete button clicked, send delete request
                    $.ajax({
                        url: '/delete-profile-image',
                        type: 'DELETE',
                        data: {
                            data: imageSrc,
                            id: accountId
                        },
                        success: function(response) {
                            // Handle the delete response
                            console.log(response);
                            // Reload the page or perform any other necessary actions
                            location.reload();
                        }
                    });
                }
            });
        });
        </script> -->
        <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFhK9-HFdkegWcsmq6ue770uDIlRX5CdI&callback=initMap&v=weekly"
        defer
      ></script>
        <script>
            window.onload = function() {
                // This code will be executed when the window has finished loading
                initMap();
            };
            function initMap() {
                const myLatlng = { lat: -25.363, lng: 131.044 };
                const map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 4,
                    center: myLatlng,
                });
                // Create the initial InfoWindow.
                let infoWindow = new google.maps.InfoWindow({
                    content: "Click the map to get Lat/Lng!",
                    position: myLatlng,
                });

                infoWindow.open(map);
                // Configure the click listener.
                map.addListener("click", (mapsMouseEvent) => {
                    // Close the current InfoWindow.
                    infoWindow.close();
                    // Create a new InfoWindow.
                    const latLng = mapsMouseEvent.latLng;
                    const latitude = latLng.lat();
                    const longitude = latLng.lng();
                    document.getElementById("updateButtonl").addEventListener("click", function() {
                        // Call your function here
                        sendLocationToServer(longitude, latitude);
                    });
                            
                    // Update the value of the input field
                    document.getElementById("locInput").value = `${latitude}, ${longitude}`;
                    infoWindow = new google.maps.InfoWindow({
                    position: mapsMouseEvent.latLng,
                    });
                    infoWindow.setContent(
                    JSON.stringify(mapsMouseEvent.latLng.toJSON(), null, 2)
                    );
                    infoWindow.open(map);
                });
            }
            function sendLocationToServer(longitude, latitude) {
                const id = '{{id}}'; // Replace 'your_id' with the actual ID value
                
                const url = `/update/loc/${id}`;
                const data = {
                    data: {
                        long: longitude,
                        lat: latitude
                    }
                };
                
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (response.ok) {
                        console.log('Location data sent successfully');
                    } else {
                        console.error('Failed to send location data');
                    };
                })
                .catch(error => {
                    console.error('Error occurred while sending location data:', error);
                });
            }
            window.initMap = initMap;
        </script>
    {%endblock%}